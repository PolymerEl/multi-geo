<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../multi-chart/container/multi-container-svg.html">
<link rel="import" href="../../multi-chart/d3-zoom/zoomable-property-mixin.html">
<link rel="import" href="../projection/d3-projection.html">
<link rel="import" href="../projection/d3-projection-mixin.html">
<link rel="import" href="../d3-geo/d3-geo-path.html">
<dom-module id="multi-container-geo">
  <template>
    <style>
      :host {
        display: block;
        @apply --layout-center-center;
        flex:1;
        height: 100%;
        /*display: flex;
        flex-direction: column;*/
      }
    </style>
    <d3-projection
      projection="{{projection}}"
      scale="{{scale}}"
      projection-type="[[projectionType]]"
      clip-angle="[[clipAngle]]"
      clip-extent="[[clipExtent]]"
      center="[[center]]"
      rotate="[[rotate]]"
      precision="[[precision]]"
      translate="[[translate]]">
    </d3-projection>
    <d3-geo-path path="{{path}}" context="[[context]]" projection="[[projection]]"></d3-geo-path>
    <multi-container-svg 
      id="chart"
      enable-zoom="[[enableZoom]]"
      extent="[[extent]]"
      scale-extent="[[scaleExtent]]"
      margin="[[margin]]">
      <slot name="header" slot="header"></slot>
      <slot></slot>
      <slot name="footer" slot="footer"></slot>
    </multi-container-svg>
  </template>
  <script>
  (function() {

    /**
     * ## MultiChartGeo
     *
     * `<multi-container-geo>` a container for geographical chart. It exposes the current geo projection
     * 
     *
     * @memberof MultiChart
     * @customElement
     * @polymer
     * @appliesMixin MultiChart.mixin.ZoomableProperty
     * @appliesMixin MultiChart.mixin.D3Projection
     * @demo index.html#multi-choropleth-demo
     * @demo index.html#multi-feature-demo
     **/
    class MultiChartGeo extends 
     MultiChart.mixin.ZoomableProperty(
      MultiChart.mixin.D3Projection(
        Polymer.Element)) {

      static get is() { return 'multi-container-geo'; }

      static get properties() {
        return {
          /**
           * `projection` the [projection](https://github.com/d3/d3-geo#projection) generator function
           */
          projection: {
            type: Function,
            notify: true
          },

          /**
           * [`scale`](https:github.com/d3/d3-geo#projection_scale)
           */
          scale: {
            type: Number,
            notify: true,
          },

          /**
           * `path` the [path](https://github.com/d3/d3-geo#geoPath) generator function
           */
          path: {
            type: Function,
            notify: true,
          },

          /**
           * [`context`](https://github.com/d3/d3-geo#path_context) to be applied to the path  
           */
          context: {
            type: Function
          },
 /* 
           * `margin` applied to svg container (not css margin, wich can also be applied as per normal css rules)
           */
          margin: {
            type: Object,
            value: {
              top: 0,
              right: 0,
              bottom: 0,
              left: 0
            }
          },


        };
      }
      
      ready() {
        super.ready();
        this.addEventListener('multi-refresh', this._onRefresh);
      }

      /* 
       * `_onRefresh` usualy happens when projection is changed, 
       * we need to adjust inner drawable like multi-drawable-feature
       * Note(cg): we are not calling this.$.chart._onRefresh because we need to bypass shallNotify test
       */
      _onRefresh() {
        this.$.chart.callRegistered('dataChanged');
      }
    }

    customElements.define(MultiChartGeo.is, MultiChartGeo);

    if (!window.MultiChart) {
      window.MultiChart = {};
    }

    /* 
     * @namespace MultiChart
     */
    window.MultiChart.MultiChartGeo = MultiChartGeo;

  })();
  </script>
</dom-module>