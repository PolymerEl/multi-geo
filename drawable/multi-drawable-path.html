<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../multi-chart/drawable/multi-drawable.html">
<link rel="import" href="multi-drawable-geo-mixin.html">
<dom-module id="multi-drawable-path-style" theme-for="multi-container-svg">
  <template>
    <style>
    .multi-drawable-path {
      stroke: var(--multi-drawable-path-stroke-color, var(--secondary-text-color, grey));
      fill: var(--multi-drawable-path-fill-color, none);
      @apply --multi-drawable-path;
    }
    </style>
  </template>
</dom-module>
<dom-module id="multi-drawable-path">
  <template>
    <svg>
      <g id="drawable" slot-svg="slot-g" class="drawable multi-drawable-path" />
    </svg>
  </template>
  <script>
  (function() {

    /**
     * ## MultiDrawablePath
     *
     * `<multi-drawable-path>` draw a line from a geo path in a given projection
     *
     * ### Styling
     * `<multi-drawable-feature>` provides the following custom properties and mixins
     * for styling:
     * 
     * Custom property | Description | Default
     * ----------------|-------------|----------
     * `--multi-drawable-feature-stroke-color` | stroke color for features | `--secondary-text-color` or grey 
     * `--multi-drawable-feature-fill-color` | fill color for features | none 
     * `--multi-drawable-feature` | Mixin applied to features | `{}`
     * 
     * @memberof MultiChart
     * @customElement
     * @polymer
     * @appliesMixin MultiChart.mixin.MultiGeoDrawable
     * @demo 
     **/
    class MultiDrawablePath extends 
          MultiChart.mixin.MultiGeoDrawable(MultiChart.MultiDrawable) {

      static get is() { return 'multi-drawable-path'; }

      static get properties() {
        return {
          /**
           * `path` the [path](https://github.com/d3/d3-geo#geoPath) generator function
           */
          path: {
            type: Function
          },

          /**
           * `attrs` default attributes to be set on the chart
           */
          attrs: {
            type: Object,
            value: function() {
              return null;
            }
          },

          registerOrder: {
            type: Number, 
            value: 50
          }
        };
      }
      /* 
       * `preDraw`  prevents to draw features if we miss path
       */
      preDraw(data) {
        if (!this.path) {
          this._warn('trying to draw but geo path is not yet set');
          return false;
        }

        if (!data && !this.drawableData) {
          this._warn('data is not yet set');
          return false;
        }
        return true;
      }

      draw(data) {
        
        this._log('draw path');

        let chart = d3.select(this.targetElement);

        chart.selectAll('*').remove();

        return chart
          .append('path')
          .datum(data)
          .attrs(this.attrs)
          .attr('d', this.path);
      }

    }

    customElements.define(MultiDrawablePath.is, MultiDrawablePath);

    if (!window.MultiChart) {
      window.MultiChart = {};
    }

    /* 
     * @namespace MultiChart
     */
    window.MultiChart.MultiDrawablePath = MultiDrawablePath;

  })();
  </script>
</dom-module>