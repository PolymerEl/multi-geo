<dom-module id="multi-choropleth-compose-demo">
  <template>
    <style include="vaadin-component-demo-shared-styles">
      :host {
        display: block;
        
        /* defines a mxin for multi-drawable-choropleth*/
        --multi-drawable-choropleth: {
            fill: var(--primary-color);
            stroke: white;
         };
              
      }
              
    </style>
    <h3>Geo Choropleth Compose Demo</h3>
    <p>This example composes appropriate web-composants. A simpler approach for rendering a choropleth chart is to use <code>multi-chart-choropleth</code> element (see choroplet demo)</p>
    <p>Example largely inspired from <a href="http://bl.ocks.org/mbostock/4060606" title="">this block</a>!</p>
    <vaadin-demo-snippet id='multi-projection-serie-demo-binding'>
      <template preserve-content>
        <dom-bind id="app">
          <template>
            <style>
             #chart {
                height: 500px;
              }
            </style>
            <!-- fetch topojson choropleths from  -->
            <topojson-feature feature="{{feature}}" data="{{geometries}}" name="counties" url="us.json"></topojson-feature>
            <!-- get a topojson mesh for states  -->
            <topojson-mesh mesh="{{mesh}}" data="[[geometries]]" name="states"></topojson-mesh>
            <!-- a multi-container-geo will expose path and projection -->
            <multi-container-geo
              id="chart"
              enable-zoom
              projection="{{projection}}"
              path="{{path}}"
              projection-type="[[projectionType]]"
              scale="{{scale}}"
              >
                <!-- group of geo elements. When choropleth changes, contained elements will redraw -->
                <multi-container-layer>
           
                  <!-- draw choropleths with projected to projection -->
                  <multi-drawable-choropleth 
                    data="[[data]]"
                    auto-fit
                    geo-data="[[feature]]"  
                    path="[[path]]"
                    attrs="[[choroplethAttrs]]" 
                    scale-type="scaleQuantize"
                    domain="[[colorDomain]]"
                    range="[[colorRange]]"
                    color-scale="{{colorScale}}" 
                    value-accessor-path="+rate"  
                    key-accessor-path="id"  
                    ></multi-drawable-choropleth>
                  
                  <!-- show US States -->
                  <multi-drawable-path 
                    path="[[path]]" 
                    attrs="[[meshAttrs]]" 
                    geo-data="[[mesh]]"></multi-drawable-path>
                </multi-container-layer>
              
                <!-- display a legend -->
                <multi-legend 
                  scale="[[colorScale]]" 
                  padding="10" 
                  title="Unemployment Rate"
                  labels="[[labels]]"
                  label-format=".0%" 
                  position="right" > </multi-legend>
              </multi-container-geo>
              <div id="control">
                <paper-input  label="scale" min="0" step="50" type="number" value="{{scale}}"></paper-input>
           
              </div>
          </template>
        </dom-bind>
      </template>
    </vaadin-demo-snippet>
    <script>
      window.addDemoReadyListener('#multi-projection-serie-demo-binding', function(document) {

      app = document.querySelector('#app');
      app.scale = 800;
      app.colorRange = d3.schemeBlues[8];
      app.colorDomain = [0.02, 0.18];
      app.projectionType = 'geoAlbersUsa';
      app.meshAttrs = {
        fill: 'none',
        'stroke-width': 2,
        stroke: '#fff'
      };

      app.labels = d3.legendHelpers.thresholdLabels;

      app.choroplethAttrs = {
        stroke: 'none'
      };

     d3.tsv('unemployment.tsv')
      .then(d => {
        app.data = d;
      });
    });
    </script>
  </template>
  <script>
  (function() {

    class ChoroplethDemo extends DemoReadyEventEmitter(MultiChart.Demo(Polymer.Element)) {
      static get is() {
        return 'multi-choropleth-compose-demo';
      }
    }
    customElements.define(ChoroplethDemo.is, ChoroplethDemo);

    if (!window.MultiChart) {
      window.MultiChart = {};
    }
    window.MultiChart.ChoroplethDemo = ChoroplethDemo;

  })();
  </script>
</dom-module>